# Makefile –¥–ª—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π C++ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏

# –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä
CXX = g++

# –§–ª–∞–≥–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
CXXFLAGS = -std=c++17 -O2 -Wall -Wextra

# –ü–∞–ø–∫–∏
SRC_DIR = src
BUILD_DIR = build
BIN_DIR = bin

# –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫–∏ –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
$(BUILD_DIR):
	mkdir -p $(BUILD_DIR)

$(BIN_DIR):
	mkdir -p $(BIN_DIR)

# –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–µ–ª–∏
.PHONY: all clean neural transformer api server help

all: neural transformer api server

# –û—Å–Ω–æ–≤–Ω–∞—è –Ω–µ–π—Ä–æ—Å–µ—Ç—å + —á–∞—Ç-–±–æ—Ç
neural: $(BIN_DIR) $(SRC_DIR)/main.cpp
	@echo "üß† –°–æ–±–∏—Ä–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –Ω–µ–π—Ä–æ—Å–µ—Ç—å..."
	$(CXX) $(CXXFLAGS) -o $(BIN_DIR)/my_neural_network $(SRC_DIR)/main.cpp
	@echo "‚úÖ –û—Å–Ω–æ–≤–Ω–∞—è –Ω–µ–π—Ä–æ—Å–µ—Ç—å —Å–æ–±—Ä–∞–Ω–∞!"

# Transformer –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞
transformer: $(BIN_DIR) $(SRC_DIR)/transformer.cpp
	@echo "üî§ –°–æ–±–∏—Ä–∞–µ–º Transformer..."
	$(CXX) $(CXXFLAGS) -o $(BIN_DIR)/transformer $(SRC_DIR)/transformer.cpp
	@echo "‚úÖ Transformer —Å–æ–±—Ä–∞–Ω!"

# API —Å–µ—Ä–≤–µ—Ä
api: $(BIN_DIR) $(SRC_DIR)/api_server.cpp
	@echo "üåê –°–æ–±–∏—Ä–∞–µ–º API —Å–µ—Ä–≤–µ—Ä..."
	$(CXX) $(CXXFLAGS) -o $(BIN_DIR)/api_server $(SRC_DIR)/api_server.cpp
	@echo "‚úÖ API —Å–µ—Ä–≤–µ—Ä —Å–æ–±—Ä–∞–Ω!"

# –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
server: neural
	@echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–µ–π—Ä–æ—Å–µ—Ç—å..."
	./$(BIN_DIR)/my_neural_network

# –ó–∞–ø—É—Å–∫ Transformer
run-transformer: transformer
	@echo "üî§ –ó–∞–ø—É—Å–∫–∞–µ–º Transformer..."
	./$(BIN_DIR)/transformer

# –ó–∞–ø—É—Å–∫ API —Å–µ—Ä–≤–µ—Ä–∞
run-api: api
	@echo "üåê –ó–∞–ø—É—Å–∫–∞–µ–º API —Å–µ—Ä–≤–µ—Ä..."
	./$(BIN_DIR)/api_server

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
test: all
	@echo "üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã..."
	@echo "\n=== –¢–µ—Å—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ ==="
	./$(BIN_DIR)/my_neural_network
	@echo "\n=== –¢–µ—Å—Ç Transformer ==="
	./$(BIN_DIR)/transformer
	@echo "\n=== –¢–µ—Å—Ç API —Å–µ—Ä–≤–µ—Ä–∞ ==="
	./$(BIN_DIR)/api_server

# –û—á–∏—Å—Ç–∫–∞
clean:
	@echo "üßπ –û—á–∏—â–∞–µ–º –ø—Ä–æ–µ–∫—Ç..."
	rm -rf $(BUILD_DIR) $(BIN_DIR)
	@echo "‚úÖ –ü—Ä–æ–µ–∫—Ç –æ—á–∏—â–µ–Ω!"

# –ü–æ–º–æ—â—å
help:
	@echo "üöÄ –°–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è C++ –Ω–µ–π—Ä–æ—Å–µ—Ç—å - Makefile"
	@echo ""
	@echo "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
	@echo "  make all          - –°–æ–±—Ä–∞—Ç—å –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã"
	@echo "  make neural       - –°–æ–±—Ä–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é –Ω–µ–π—Ä–æ—Å–µ—Ç—å"
	@echo "  make transformer  - –°–æ–±—Ä–∞—Ç—å Transformer"
	@echo "  make api          - –°–æ–±—Ä–∞—Ç—å API —Å–µ—Ä–≤–µ—Ä"
	@echo "  make server       - –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é –Ω–µ–π—Ä–æ—Å–µ—Ç—å"
	@echo "  make run-transformer - –ó–∞–ø—É—Å—Ç–∏—Ç—å Transformer"
	@echo "  make run-api      - –ó–∞–ø—É—Å—Ç–∏—Ç—å API —Å–µ—Ä–≤–µ—Ä"
	@echo "  make test         - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã"
	@echo "  make clean        - –û—á–∏—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç"
	@echo "  make help         - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É"
	@echo ""
	@echo "–ü—Ä–∏–º–µ—Ä—ã:"
	@echo "  make all && make test    # –°–æ–±—Ä–∞—Ç—å –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ"
	@echo "  make neural && make server  # –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–µ–π—Ä–æ—Å–µ—Ç—å"

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–¥–ª—è Windows)
install-deps:
	@echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
	@echo "–î–ª—è Windows:"
	@echo "  winget install mingw-w64"
	@echo "–ò–ª–∏ —á–µ—Ä–µ–∑ chocolatey:"
	@echo "  choco install mingw"
	@echo "–î–ª—è Linux:"
	@echo "  sudo apt-get install g++"
	@echo "–î–ª—è macOS:"
	@echo "  brew install gcc"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞
check-compiler:
	@echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä..."
	@$(CXX) --version || echo "‚ùå –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω! –í—ã–ø–æ–ª–Ω–∏—Ç–µ: make install-deps"



